# CMake 最低版本要求
# CMake_minimum_required (VERSION 2.8)

# 项目信息
 project (aliyun-assist)

# 包含头文件和库文件目录 
include_directories(${CMAKE_CURRENT_BINARY_DIR})
include_directories(../third_party)
include_directories(../common)
include_directories(../task_engine)

include_directories(../third_party/libcurl/include)
link_directories(../third_party/libcurl/lib)

link_directories(../common)
add_definitions(-DCURL_STATICLIB)
if(WIN32)
    set(CMAKE_EXE_LINKER_FLAGS_RELEASE "/INCREMENTAL:NO /DEBUG")
    set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} /MT")
    set(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} /MTd")
    include_directories(./windows)
    aux_source_directory(./windows DIR_SRCS)
	link_libraries(shlwapi Psapi version)
	link_libraries(ws2_32 Wldap32)
	link_libraries(libcurl.lib)
    link_libraries(PowrProf)
	add_definitions(-DUNICODE -D_UNICODE)  
else(UNIX)
    include_directories(./linux)
    aux_source_directory(./linux DIR_SRCS)
    INCLUDE_DIRECTORIES(/usr/include)
    LINK_DIRECTORIES(/usr/lib)
    LINK_DIRECTORIES(/usr/local/lib)
    link_libraries(rt)
    add_compile_options(-std=c++11)
	set(CMAKE_EXE_LINKER_FLAGS "-static")
endif()
	link_libraries(assist-common)
    link_libraries(third_party)
	aux_source_directory(../task_engine DIR_SRCS)
    aux_source_directory(../task_engine/plugin DIR_SRCS)
if(WIN32)
	add_executable(aliyun_assist_service ${DIR_SRCS} service_win.cpp gshell_win.cpp ./windows/xs_shell.cc ./windows/xs.cc ./windows/log_util.cc ../VersionResource.rc)
else(UNIX)
    add_executable(aliyun-service ${DIR_SRCS} service_linux.cpp gshell_linux.cpp ./linux/xs_shell.c ./linux/xs.c ./linux/log_util.c ../VersionResource.rc)
endif()

if(WIN32)
SET_TARGET_PROPERTIES(aliyun_assist_service PROPERTIES RUNTIME_OUTPUT_DIRECTORY_DEBUG   ${CMAKE_CURRENT_SOURCE_DIR}/../output/)
SET_TARGET_PROPERTIES(aliyun_assist_service PROPERTIES RUNTIME_OUTPUT_DIRECTORY_RELEASE ${CMAKE_CURRENT_SOURCE_DIR}/../output/)
else(UNIX)
TARGET_LINK_LIBRARIES(aliyun-service -lcurl -lpthread)
SET_TARGET_PROPERTIES(aliyun-service PROPERTIES RUNTIME_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/../output/)
endif()
